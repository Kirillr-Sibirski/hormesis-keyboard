units:
  px: cx + 2
  py: cy + 2

  pushX: (cx / 2)
  pushY: (cy / 2)

  padX: pushX + 2
  padY: pushY + 2

points:
  key.padding: cy
  zones:
    main:
      anchor:
        # Shift the PCB slightly to the right and down, otherwise it's weirdly positioned outside of the main sheet in KiCad
        shift: [100, -150]
      rows:
        bottom:
          row_net: P9
        home:
          row_net: P8
        top:
          row_net: P7
        num:
          row_net: P6
      columns:
        pinky:
          key:
            spread: cx
            bind: [16, 0, 0, 0]
            column_net: P1
          rows:
            bottom:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_ring_bottom
            home:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_pinky_bottom
            top:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_outer_top
            num:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_pinky_top
        ring:
          key:
            stagger: 12
            spread: cx
            bind: [4, 0, 12, 0]
            column_net: P2
          rows:
            bottom:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_ring_home
            home:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_ring_top
            top:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_middle_top
            num:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_pinky_num
        middle:
          key:
            stagger: 4
            spread: cx
            bind: [0, 0, 16, 0]
            column_net: P3
          rows:
            bottom:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_index_bottom
            home:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_middle_bottom
            top:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_middle_home
            num:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_ring_num
        index:
          key:
            stagger: -8
            spread: cx
            bind: [8, 0, 8, 0]
            column_net: P4
          rows:
            bottom:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_index_home
            home:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_index_top
            top:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_inner_top
            num:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_middle_num
        inner:
          key:
            stagger: -2
            spread: cx
            bind: [10, 0, 0, 0]
            column_net: P5
          rows:
            bottom:
              led_in: "rgb_{{name}}"
              led_out: rgb_thumbfan_near
            home:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_inner_bottom
            top:
              led_in: "rgb_{{name}}"
              led_out: rgb_main_inner_home
            num:
              led_in: P21
              led_out: rgb_main_index_num
    outer:
      anchor:
        ref: main_pinky_home
        shift: [-18, 0]
      columns:
        outer:
          key:
            spread: cx
            bind: [33, 0, 0, 0]
            column_net: P0
      rows:
        top:
          row_net: P7
          led_in: "rgb_{{name}}"
          led_out: rgb_main_outer_home
        home:
          row_net: P8
          led_in: "rgb_{{name}}"
          led_out: rgb_main_pinky_home
    thumbfan:
      anchor:
        ref: main_inner_bottom
        shift: [-10, -17]
      columns:
        near:
          key:
            bind: [0, 3, 0, 0]
            column_net: P3
            led_in: "rgb_{{name}}"
            led_out: rgb_thumbfan_home
        home:
          key:
            spread: 21
            splay: -18
            origin: [-12, -9]
            bind: [0.6, 2, 0, 4]
            column_net: P4
            led_in: "rgb_{{name}}"
            led_out: rgb_thumbfan_far
        far:
          key:
            spread: 21
            splay: -10
            origin: [-10, -9]
            bind: [0.3, 0, 0, 4]
            column_net: P5
            led_in: "rgb_{{name}}"
            # no led_out
      rows:
        thumb:
          row_net: P10
outlines:
  main:
    - where: true
      bound: true
      what: rectangle
      size: [cx + 2, cy + 2]
      fillet: 2
  leftkeys:
    - where: true
      what: rectangle
      size: [14, 14]
  leftcutout:
    - name: main
    - operation: subtract
      name: leftkeys

pcbs:
  main_pcb:
    outlines:
      main:
        outline: main
    footprints:
      keyswitches:
        where: true
        what: choc
        params:
          keycaps: true
          hotswap: true
          reverse: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      promicro:
        what: promicro_pretty
        where:
          shift: [81.725, -90.2]
        params:
          reversible: true
          reverse_mount: true
      # Reset switch (horizontal community version)
      horizontal_reset:
        what: EVQPUC
        params:
          side: B
          from: GND
          to: RST
        where:
          shift: [99.875, -75.375]
          rotate: 0
      horizontal_reset_front:
        what: EVQPUC
        params:
          side: F
          from: GND
          to: RST
        where:
          shift: [99.875, -75.375]
          rotate: 0
      front_text: &text
        what: text
        where: &textWhere
          shift: [115.5, -152.5]
        params: &textParams
          text: hormesis
          justify: left
          h_size: 4.0
          v_size: 4.0
          thickness: 0.5
      back_text:
        <<: *text
        where: &textWhere
          <<: *textWhere
          shift: [150, -152.5]
        params: &textParams
          <<: *textParams
          layer: B.SilkS
          text: by karl ryberg
          justify: mirror left
          h_size: 3.0
          v_size: 3.0
          thickness: 0.4
      # Main diodes
      diode_main:
        what: diode
        where: true
        params:
          from: "{{name}}"
          to: "{{row_net}}"
        adjust:
          shift: [7.8, -3.5]
          rotate: 90
      led:
        what: sk6812mini
        where: true
        adjust:
          shift: [0, -5]
        params:
          din: "{{led_in}}"
          dout: "{{led_out}}"
          cutout: true
      # Battery jack
      jstph:
        what: jstph
        where:
          shift: [169.5, -81]
          rotate: 90
        params:
          side: B
          pos: pos
          neg: GND
      jstph_front:
        what: jstph
        where:
          shift: [167.5, -81]
          rotate: 90
        params:
          side: F
          pos: pos
          neg: GND
      # Battery on/off switch
      battery_switch:
        what: switch_power
        where:
          shift: [113, -75]
          rotate: 90
        params:
          reverse: true
          from: pos
          to: RAW
      # Mounting holes
      # hole_thumb_top:
      #   what: mountinghole
      #   where:
      #     shift: [217.5, -168]
      # hole_right_top:
      #   what: mountinghole
      #   where:
      #     shift: [179.5, -76]
      # hole_left_bottom:
      #   what: mountinghole
      #   where:
      #     shift: [88.5, -157]
      # hole_left_second_bottom:
      #   what: mountinghole
      #   where:
      #     shift: [70.5, -140]
      # hole_thumb_left:
      #   what: mountinghole
      #   where:
      #     shift: [174, -160.5]
      # hole_center_bottom:
      #   what: mountinghole
      #   where:
      #     shift: [133, -157]
      # hole_center_left:
      #   what: mountinghole
      #   where:
      #     shift: [111, -112.5]
      # hole_center_right:
      #   what: mountinghole
      #   where:
      #     shift: [165, -133.5]
      # hole_left_top:
      #   what: mountinghole
      #   where:
      #     shift: [70.5, -76]
      # hole_center_top:
      #   what: mountinghole
      #   where:
      #     shift: [147.5, -99]
cases:
  plate:
    - name: leftcutout
      extrude: 1.2
